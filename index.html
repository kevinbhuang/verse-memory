<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripture Memory Vault</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --gold: #f1c40f;
            --light: #ecf0f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--primary);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 12px;
            shadow: 0 4px 6px rgba(0,0,0,0.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h1 { text-align: center; color: var(--primary); }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .input-section, .quiz-section, .list-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        textarea {
            width: 100%;
            height: 80px;
            margin: 10px 0;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { opacity: 0.8; }
        .btn-success { background: var(--success); }

        .verse-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .modes {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #display-area {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            min-height: 50px;
            text-align: center;
        }

        .award-icon {
            font-size: 2rem;
            margin: 5px;
            display: inline-block;
        }

        .hidden { display: none; }
        
        .first-letter-input {
            letter-spacing: 2px;
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Scripture Memory Vault</h1>

    <div class="stats-bar">
        <div>üî• Streak: <span id="streak-val">0</span> days</div>
        <div>üèÜ Awards: <span id="awards-list"></span></div>
    </div>

    <div class="input-section">
        <h3>Add New Verse (ESV)</h3>
        <input type="text" id="ref-input" placeholder="Reference (e.g., Romans 8:1)">
        <textarea id="text-input" placeholder="Paste ESV text here..."></textarea>
        <button onclick="saveVerse()">Save to List</button>
    </div>

    <div class="list-section">
        <h3>My Verse List</h3>
        <div id="verse-list-container"></div>
    </div>

    <div id="quiz-area" class="quiz-section hidden">
        <h2 id="current-ref">---</h2>
        <div class="modes">
            <button onclick="setupMode('firstLetter')">First Letter</button>
            <button onclick="setupMode('fillBlank')">Fill Blank</button>
            <button onclick="setupMode('mc')">Multiple Choice</button>
        </div>
        
        <div id="display-area"></div>
        <div id="interaction-area"></div>
        <p id="feedback"></p>
        <button class="btn-success" onclick="closeQuiz()">Finish Session</button>
    </div>
</div>

<script>
    let verses = JSON.parse(localStorage.getItem('verses')) || [];
    let stats = JSON.parse(localStorage.getItem('memStats')) || { streak: 0, lastDate: null, awards: [] };
    let currentVerse = null;

    function saveVerse() {
        const ref = document.getElementById('ref-input').value;
        const text = document.getElementById('text-input').value;
        if (ref && text) {
            verses.push({ ref, text });
            localStorage.setItem('verses', JSON.stringify(verses));
            renderList();
            document.getElementById('ref-input').value = '';
            document.getElementById('text-input').value = '';
        }
    }

    function renderList() {
        const container = document.getElementById('verse-list-container');
        container.innerHTML = '';
        verses.forEach((v, index) => {
            const div = document.createElement('div');
            div.className = 'verse-item';
            div.innerHTML = `
                <span><strong>${v.ref}</strong></span>
                <button onclick="startQuiz(${index})">Practice</button>
            `;
            container.appendChild(div);
        });
    }

    function startQuiz(index) {
        currentVerse = verses[index];
        document.getElementById('quiz-area').classList.remove('hidden');
        document.getElementById('current-ref').innerText = currentVerse.ref;
        setupMode('firstLetter');
        window.scrollTo(0, document.body.scrollHeight);
    }

    function setupMode(mode) {
        const display = document.getElementById('display-area');
        const interaction = document.getElementById('interaction-area');
        const feedback = document.getElementById('feedback');
        display.innerHTML = '';
        interaction.innerHTML = '';
        feedback.innerText = '';

        const words = currentVerse.text.split(/\s+/);

        if (mode === 'firstLetter') {
            display.innerText = "Type the first letter of each word:";
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'first-letter-input';
            input.placeholder = 'Start typing...';
            
            let progress = [];
            input.oninput = (e) => {
                const val = input.value.toUpperCase();
                const targetLetters = words.map(w => w.replace(/[^a-zA-Z]/g, '')[0]?.toUpperCase());
                
                if (val[val.length - 1] === targetLetters[val.length - 1]) {
                    feedback.innerText = "Correct!";
                    feedback.style.color = "green";
                    if (val.length === targetLetters.length) {
                        completeAction();
                    }
                } else {
                    feedback.innerText = "Try again...";
                    feedback.style.color = "red";
                    input.value = val.slice(0, -1);
                }
            };
            interaction.appendChild(input);

        } else if (mode === 'fillBlank') {
            let displayedText = words.map((w, i) => {
                return (i % 3 === 0 && i !== 0) ? "_____" : w;
            }).join(' ');
            display.innerText = displayedText;
            
            const btn = document.createElement('button');
            btn.innerText = "Check Answer";
            btn.onclick = () => {
                display.innerText = currentVerse.text;
                completeAction();
            };
            interaction.appendChild(btn);

        } else if (mode === 'mc') {
            display.innerText = "Which is the correct text?";
            const options = [currentVerse.text, "A different holy verse text...", "A paraphrased version of this verse."];
            options.sort(() => Math.random() - 0.5);
            
            options.forEach(opt => {
                const b = document.createElement('button');
                b.style.display = 'block';
                b.style.margin = '10px auto';
                b.innerText = opt;
                b.onclick = () => {
                    if (opt === currentVerse.text) {
                        feedback.innerText = "Perfect!";
                        completeAction();
                    } else {
                        feedback.innerText = "Not quite.";
                    }
                };
                interaction.appendChild(b);
            });
        }
    }

    function completeAction() {
        updateStreak();
        checkAwards();
        renderStats();
    }

    function updateStreak() {
        const today = new Date().toDateString();
        if (stats.lastDate !== today) {
            if (stats.lastDate === new Date(Date.now() - 86400000).toDateString()) {
                stats.streak++;
            } else {
                stats.streak = 1;
            }
            stats.lastDate = today;
            localStorage.setItem('memStats', JSON.stringify(stats));
        }
    }

    function checkAwards() {
        if (stats.streak >= 3 && !stats.awards.includes('ü•â')) stats.awards.push('ü•â');
        if (stats.streak >= 7 && !stats.awards.includes('ü•à')) stats.awards.push('ü•à');
        if (verses.length >= 5 && !stats.awards.includes('üìö')) stats.awards.push('üìö');
        localStorage.setItem('memStats', JSON.stringify(stats));
    }

    function renderStats() {
        document.getElementById('streak-val').innerText = stats.streak;
        document.getElementById('awards-list').innerText = stats.awards.join(' ');
    }

    function closeQuiz() {
        document.getElementById('quiz-area').classList.add('hidden');
    }

    renderList();
    renderStats();
</script>

</body>
</html>
